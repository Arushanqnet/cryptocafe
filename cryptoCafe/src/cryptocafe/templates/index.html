<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CryptoCafe - Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    >
    <style>
      /* Overlay container to cover full screen */
      #loadingOverlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7); /* semi-transparent black */
        display: none; /* hidden by default */
        justify-content: center;
        align-items: center;
        z-index: 9999; /* on top of everything */
      }
      .overlay-content {
        text-align: center;
        color: #fff;
      }
      .overlay-logo {
        width: 100px;
        height: 100px;
        margin-bottom: 2rem;
      }
      /* Larger progress bar styling */
      .overlay-progress {
        width: 300px;
        margin: 0 auto;
      }
      .overlay-progress .progress-bar {
        transition: width 0.3s ease;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">CryptoCafe</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            {% if user %}
              <li class="nav-item">
                <a class="nav-link" href="/settings">Settings</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/logout">Logout</a>
              </li>
            {% else %}
              <li class="nav-item">
                <a class="nav-link" href="/login">Sign in</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      {% if not user %}
        <h1>Welcome to CryptoCafe</h1>
        <p>Please <a href="/login">sign in with Google</a> to customize your news feed.</p>
      {% else %}
        <h1>Hello, {{ user.name }}!</h1>
        <form action="/search" method="POST" class="row g-3 mb-4"  onsubmit="showLoadingOverlay()" >
          <div class="col-md-6">
            <input 
              type="text" 
              class="form-control" 
              name="query" 
              placeholder="Search anything..."
              required
            >
          </div>
          <div class="col-md-3" hidden>
            <select class="form-select" name="tts_type">
              <option value="">(Use My Default Style)</option>
              <option value="default">Default TTS</option>
              <option value="radio style">Radio Style</option>
              <option value="female voice">Female Voice</option>
              <option value="male voice">Male Voice</option>
            </select>
          </div>
          <div class="col-md-3">
            <button class="btn btn-primary w-100">Search &amp; Fetch</button>
          </div>
        </form>
        <h2>Your Personalized Articles</h2>
      {% endif %}

      <!-- Card grid for articles -->
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for item in data %}
          <div class="col">
            <div 
              class="card h-100 shadow-sm"
              onclick="location.href='/reels?index={{ loop.index0 }}';"
              style="cursor:pointer;"
            >
              <img 
                src="{{ item.image_url }}" 
                class="card-img-top"
                alt="News image"
                onerror="this.src='https://via.placeholder.com/350x200.png?text=No+Image';"
              >
              <div class="card-body">
                <h5 class="card-title">{{ item.title }}</h5>
                <p class="card-text">{{ item.text }}</p>
              </div>
              <div class="card-footer">
                <small class="text-muted">Source: {{ item.source_name }}</small><br>
                <small class="text-muted">Date: {{ item.date }}</small>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <!-- The Full-Screen Overlay -->
    <div id="loadingOverlay">
      <div class="overlay-content">
        <!-- Replace with your own icon/logo -->
        <img
          class="overlay-logo"
          src="https://via.placeholder.com/100x100.png?text=Logo"
          alt="Loading Logo"
        >
        <div class="mb-3">Loading, please wait...</div>

        <!-- Bootstrap progress bar -->
        <div class="progress overlay-progress" style="height: 25px;">
          <div
            id="overlayProgressBar"
            class="progress-bar progress-bar-striped progress-bar-animated bg-info"
            role="progressbar"
            style="width: 0%;"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            0%
          </div>
        </div>
      </div>
    </div>
    <!-- Bootstrap JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
    </script>
 <!-- JavaScript for showing/animating overlay -->
 <script>
  let overlayTimer = null;
  let currentValue = 0;

  function showLoadingOverlay() {
    // 1) Show the overlay
    document.getElementById("loadingOverlay").style.display = "flex";

    // 2) Reset progress
    currentValue = 0;
    const pb = document.getElementById("overlayProgressBar");
    pb.style.width = "0%";
    pb.textContent = "0%";

    // 3) Start a timer to animate progress from 0% -> 80~90%
    //    We'll let the final page load finish the rest.
    overlayTimer = setInterval(() => {
      if (currentValue < 90) {
        currentValue += 2; // increment by 2
        pb.style.width = currentValue + "%";
        pb.textContent = currentValue + "%";
      } else {
        // Once we get to 90, we just hold.
        clearInterval(overlayTimer);
      }
    }, 200); // update every 0.2s
  }
</script>
    <script>
      let synth = window.speechSynthesis;
        synth.cancel();
    </script>
  </body>
</html>
